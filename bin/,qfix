#!/usr/bin/env python3
import sys
import re

dir_text = r"ninja: Entering directory `(.*)'"
cpp_text = r"([^\s].*):(\d+):(\d+): (.*): (.*)"
rs_text = r"(error|warning).*: (.*)"
rs2_text = r" +--> (.*)"

dir = ""
log_line = False

for line in sys.stdin:
    if log_line:
        print("#", line, end="")
    dir_match = re.match(dir_text, line)
    if dir_match:
        dir = dir_match.group(1)
        continue
    cpp_match = re.match(cpp_text, line)
    if cpp_match:
        print(dir + "/" + line, end="")
        continue
    rs_match = re.match(rs_text, line)
    if rs_match:
        next = sys.stdin.readline()
        match = re.match(rs2_text, next)
        if match:
            print(dir + "/" + match.group(1) + " " + line.strip())
            log_line = True
        else:
            log_line = False

